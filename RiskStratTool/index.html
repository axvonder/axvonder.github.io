<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food is Medicine Program Selection – Program Design Decision Support Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#1f6feb;
      --brand-600:#2c6ce6;
      --brand-700:#1b56c7;
      --ink:#111827;
      --ink-2:#475569;
      --muted:#6b7280;
      --bg:#eef3fb;
      --panel:#ffffff;
      --panel-tint:#f8fbff;
      --stroke:#d9e6ff;
      --stroke-strong:#b9d2ff;
      --success:#2e9850;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      font-family:'Roboto',sans-serif;
      color:var(--ink);
      background:var(--bg);
      margin:0;
      padding:40px 16px;
    }
    .container{
      max-width:980px;margin:0 auto;background:var(--panel);
      border-radius:var(--radius);padding:36px 28px 32px;
      box-shadow:0 10px 36px rgba(16,24,40,.08);
    }
    .header{display:flex;justify-content:center;margin-bottom:8px}
    .logo{max-width:340px;height:auto}
    .logo-fallback{
      display:none;
      font-weight:700; color:var(--brand);
      border:1px solid var(--stroke); border-radius:20px;
      padding:6px 10px; font-size:13px;
    }
    .hero-title{margin:10px 0 4px;text-align:center;color:var(--brand);font-size:30px;line-height:1.2}
    .hero-sub{display:block;text-align:center;margin-top:2px;margin-bottom:20px;color:var(--muted);font-size:15px;font-weight:700;letter-spacing:.02em}

    .hero-desc-wrap{ max-width:740px; margin:26px auto 34px; padding:0 16px; }
    .hero-desc{ margin:0 0 18px; text-align:left; font-size:16px; line-height:1.7; color:var(--ink-2); font-weight:400; }
    .hero-desc:last-child{ margin-bottom:0; }

    .tool-box{ margin-top:22px; border:1.5px solid var(--stroke); border-radius:14px; padding:18px; background:var(--panel-tint); }
    .progress-wrap{ display:none; align-items:center; gap:10px; margin:0 0 12px; }
    .progress{ flex:1; height:8px; background:#e6efff; border-radius:999px; overflow:hidden; }
    .progress .bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--brand-600),var(--brand)); }
    .progress-label{ font-size:12px; color:var(--muted); }

    .qbox{ padding:8px 2px 2px; }
    .question{ display:none; opacity:0; transition:opacity .2s ease; }
    .question.visible{ display:block; opacity:1; }
    .question h3{ margin:4px 0 2px; font-size:16px; text-align:center; color:#0f2957; }
    .question p.prompt{ margin:6px 0 16px; font-size:18px; color:#374151; text-align:center; }
    .choices{ display:grid; gap:12px; max-width:820px; margin:0 auto; }
    @media (min-width: 880px){ .choices{ grid-template-columns:1fr 1fr; } }
    .choice-card{
      display:flex; flex-direction:column; gap:4px;
      background:#fff; border:1.5px solid var(--stroke); border-radius:12px;
      padding:14px 16px; cursor:pointer; text-align:left;
      transition: box-shadow .15s ease, border-color .15s ease, transform .06s ease, background .15s ease;
    }
    .choice-card:hover{ border-color:var(--stroke-strong); background:#fcfeff; box-shadow:0 8px 20px rgba(31,111,235,.08); }
    .choice-card:focus-visible{ outline:3px solid var(--stroke-strong); outline-offset:2px; }
    .choice-title{ font-weight:700; font-size:16px; color:#0f2957; }
    .choice-sub{ font-size:14px; color:#6b7280; line-height:1.45; }
    .choice-chevron{ margin-left:auto; font-size:18px; color:#9aa7c0 }

    #tool-title{ margin:2px 0 8px; color:#0f2957; font-size:22px; }
    #tool-title.assessing{ font-size:18px; }

    .cta{
      display:inline-block; background:var(--brand); color:#fff; border:none; border-radius:12px;
      padding:16px 28px; font-size:18px; font-weight:700; cursor:pointer;
      transition:background .2s, transform .15s, box-shadow .2s; box-shadow:0 6px 16px rgba(31,111,235,.22);
    }
    .cta:hover{ background:var(--brand-700); transform:translateY(-1px); }
    .cta:focus-visible{ outline:3px solid var(--stroke-strong); outline-offset:2px; }

    /* Result screen */
    #result{ display:none; opacity:0; transition:opacity .2s ease; margin-top:8px; }
    #result.visible{ display:block; opacity:1; }
    #result-card{
      background:#ffffff; border-radius:12px; padding:32px 28px 26px;
      max-width:820px; margin:0 auto;
      box-shadow:0 6px 18px rgba(17,24,39,.04);
    }

    /* Selection trail */
    .trail{ text-align:center; color:#374151; font-size:15px; margin:0 0 20px; }
    .trail strong{ color:#0f2957; }
    .trail .arrow{ margin:0 6px; color:#94a3b8; }

    .result-header{ display:flex; flex-direction:column; align-items:center; text-align:center; gap:14px; margin-bottom:12px; }
    .result-title{ margin:0; color:#0f2957; font-size:20px; }
    .rec-badge{
      display:inline-flex; align-items:center; justify-content:center;
      background:#ecfdf3; color:var(--success); border:1px solid #b7f0c8;
      padding:12px 18px; border-radius:999px; font-weight:800; font-size:22px;
    }
    #note{ color:#4b5563; font-style:italic; margin:16px 0 18px; text-align:center; }

    .actions{ display:flex; justify-content:center; flex-wrap:wrap; gap:14px; margin-top:16px; }
    .btn{ appearance:none; border:none; border-radius:12px; padding:12px 16px; font-size:15px; cursor:pointer; }
    .btn.primary{ background:var(--brand); color:#fff; box-shadow:0 4px 10px rgba(31,111,235,.18); }
    .btn.primary:hover{ background:var(--brand-700); }
    .btn.secondary{ background:#eef2f7; color:#111827; border:1px solid #e5e7eb; }
    .btn.secondary:hover{ background:#e6ebf2; }

    #see-how{ display:none; margin-top:34px; font-weight:700; text-align:center; }
    #example{ display:none; font-size:14px; color:#374151; margin-top:10px; text-align:center; }

    footer.page-footer{ text-align:center; color:#6b7280; font-size:13px; margin-top:20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="Graphics/Food-Is-Medicine-Logo.png" alt="Tufts Food is Medicine Logo" class="logo"
           onerror="this.style.display='none'; document.getElementById('logo-fallback').style.display='inline-block';">
      <div id="logo-fallback" class="logo-fallback">Tufts Food is Medicine</div>
    </div>

    <h1 class="hero-title">Food is Medicine Program Selection</h1>
    <div class="hero-sub">Program Design Decision Support Tool</div>

    <div class="hero-desc-wrap">
      <p class="hero-desc">These recommendations are intended as a guide to help identify the Food is Medicine program model that best fits your population’s clinical and social risk profile.</p>
      <p class="hero-desc">They are not prescriptive. Every organization will have unique operational, budgetary, and community considerations. Further, shared decision-making within your care teams and with community partners should inform how programs are implemented, adapted, and scaled over time.</p>
    </div>

    <div class="tool-box">
      <div class="progress-wrap" id="progress-wrap" aria-hidden="true">
        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="bar" id="bar"></div></div>
        <div class="progress-label" id="progress-label">Step 1 of 3</div>
      </div>

      <h2 id="tool-title">Which program model is right for your population?</h2>

      <div class="qbox">
        <div id="intro" class="question visible" style="display:block;">
          <p style="text-align:center;color:#374151">Explore this interactive tool to identify the best-fit intervention to match program intensity to population need and optimize impact.</p>
          <div style="text-align:center"><button class="cta" onclick="startTool()">Start Assessment</button></div>
        </div>

        <!-- Q1 -->
        <div id="q1" class="question">
          <h3>Question 1</h3>
          <p class="prompt">How well controlled is diabetes within your population?</p>
          <div class="choices">
            <button class="choice-card" type="button" onclick="answerQ1(true)">
              <span class="choice-title">Mostly controlled</span>
              <span class="choice-sub">Majority of members have HbA1c &le; 8.0%.</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
            <button class="choice-card" type="button" onclick="answerQ1(false)">
              <span class="choice-title">Largely uncontrolled</span>
              <span class="choice-sub">Many members have HbA1c &gt; 8.0% or limited engagement in care.</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
          </div>
        </div>

        <!-- Q2 -->
        <div id="q2" class="question">
          <h3>Question 2</h3>
          <p class="prompt">How medically complex is your population, or how high is their risk for adverse health events?</p>
          <div class="choices">
            <button class="choice-card" type="button" onclick="answerQ2(true)">
              <span class="choice-title">High clinical risk</span>
              <span class="choice-sub">A large portion has advanced or multiple chronic conditions (e.g., diabetes with neuropathy or heart failure, CKD, frequent hospitalizations).</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
            <button class="choice-card" type="button" onclick="answerQ2(false)">
              <span class="choice-title">Lower clinical risk</span>
              <span class="choice-sub">Most individuals are managing a single chronic condition or are stable with routine outpatient care.</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
          </div>
        </div>

        <!-- Q3 -->
        <div id="q3" class="question">
          <h3>Question 3</h3>
          <p class="prompt">How difficult is it for your population to access healthy food?</p>
          <div class="choices">
            <button class="choice-card" type="button" onclick="answerQ3(true)">
              <span class="choice-title">High social risk</span>
              <span class="choice-sub">A large portion faces barriers such as food or nutrition insecurity, financial strain, housing instability, or limited social support.</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
            <button class="choice-card" type="button" onclick="answerQ3(false)">
              <span class="choice-title">Lower social risk</span>
              <span class="choice-sub">Most individuals have consistent access to affordable, nutritious food and stable living conditions.</span>
              <span class="choice-chevron" aria-hidden="true">›</span>
            </button>
          </div>
        </div>

        <!-- Result -->
        <div id="result">
          <div id="result-card">
            <div id="trail" class="trail" aria-live="polite"></div>

            <div class="result-header">
              <h3 class="result-title">Recommended FIM Program</h3>
              <div id="rec" class="rec-badge"></div>
            </div>

            <p id="note"></p>

            <div class="actions">
              <button class="btn primary" id="download-btn" onclick="downloadOnePager()">Download One-Pager</button>
              <button class="btn secondary" id="reset-btn" onclick="resetTool()">Assess Another Population</button>
            </div>

            <div id="see-how">See how this works…</div>
            <div id="example"></div>
          </div>
        </div>

      </div><!-- /qbox -->
    </div><!-- /tool-box -->
  </div><!-- /container -->

  <footer class="page-footer">
    For planning and design guidance only; not a substitute for clinical judgment.
  </footer>

  <script>
    let bloodWell, medComplex, accessDiff;
    const pdfMap = {
      'Education Only': 'Education.pdf',
      'Education + PRx': 'PRx.pdf',
      'Education + MTG': 'MTG.pdf',
      'Education + MTM': 'MTM.pdf'
    };
    const exampleFileMap = {
      'Education Only': 'examples/education.txt',
      'Education + PRx': 'examples/prx.txt',
      'Education + MTG': 'examples/mtg.txt',
      'Education + MTM': 'examples/mtm.txt'
    };

    const progressWrap = document.getElementById('progress-wrap');
    const bar = document.getElementById('bar');
    const label = document.getElementById('progress-label');

    function setProgress(step){
      const max = 4;
      const pct = Math.min(100, Math.max(0, (step/max)*100));
      bar.style.width = pct + '%';
      if(step >= 1 && step <= 3){
        progressWrap.style.display = 'flex';
        label.textContent = 'Step ' + step + ' of 3';
        bar.parentElement.setAttribute('aria-valuenow', String(pct));
      } else if(step === 4){
        progressWrap.style.display = 'flex';
        label.textContent = 'Complete';
        bar.parentElement.setAttribute('aria-valuenow', '100');
      } else {
        progressWrap.style.display = 'none';
        bar.parentElement.setAttribute('aria-valuenow', '0');
      }
    }

    function startTool(){
      document.getElementById('intro').style.display='none';
      showElement('q1');
      document.getElementById('tool-title').classList.add('assessing');
      setProgress(1);
    }
    function answerQ1(ans){ bloodWell = ans; document.getElementById('q1').style.display='none'; showElement('q2'); setProgress(2); }
    function answerQ2(ans){ medComplex = ans; document.getElementById('q2').style.display='none'; showElement('q3'); setProgress(3); }
    function answerQ3(ans){ accessDiff = ans; document.getElementById('q3').style.display='none'; showResult(); setProgress(4); }

    function selectionLabel(){
      const a1 = bloodWell ? 'largely controlled HbA1c' : 'largely uncontrolled HbA1c';
      const a2 = medComplex ? 'high clinical risk' : 'lower clinical risk';
      const a3 = accessDiff ? 'high social risk' : 'lower social risk';
      return a1 + ' \u2192 ' + a2 + ' \u2192 ' + a3;
    }

    function showResult(){
      let rec = '', note = '';

      // Special case per request: controlled + lower clinical risk + high social risk -> Education + PRx
      if (bloodWell && !medComplex && accessDiff){
        rec = 'Education + PRx';
        note = 'If not available, consider SNAP/WIC with education.';
      } else if (bloodWell){
        rec = 'Education Only';
      } else if (!medComplex && !accessDiff){
        rec = 'Education Only';
      } else if (!medComplex && accessDiff){
        rec = 'Education + PRx';
        note = 'If not available, consider SNAP/WIC with education.';
      } else if (medComplex && !accessDiff){
        rec = 'Education + MTG';
        note = 'If not available, consider alternative options such as Produce Prescription or SNAP/WIC.';
      } else {
        rec = 'Education + MTM';
        note = 'If not available, consider alternative options such as Medically Tailored Groceries or SNAP/WIC.';
      }

      // Populate the selection trail
      const trail = document.getElementById('trail');
      trail.innerHTML = '<strong>You chose:</strong> ' + selectionLabel();

      document.getElementById('rec').textContent = rec;
      document.getElementById('note').textContent = note;

      // Hide the "Which program..." header on results
      const toolTitle = document.getElementById('tool-title');
      toolTitle.dataset.prevDisplay = toolTitle.style.display || '';
      toolTitle.style.display = 'none';

      loadExample(rec);
      showElement('result');
    }

    function loadExample(rec){
      const file = exampleFileMap[rec];
      const see = document.getElementById('see-how');
      const ex = document.getElementById('example');
      if (!file){ see.style.display='none'; ex.style.display='none'; return; }
      fetch(file)
        .then(r => { if(!r.ok) throw new Error('File not found'); return r.text(); })
        .then(text => {
          if(text && text.trim().length>0){
            see.style.display = 'block';
            ex.style.display = 'block';
            ex.textContent = text;
          }else{
            see.style.display='none'; ex.style.display='none';
          }
        })
        .catch(() => { see.style.display='none'; ex.style.display='none'; });
    }

    function downloadOnePager(){
      const rec = document.getElementById('rec').textContent;
      const pdfFile = pdfMap[rec] || 'default.pdf';
      window.open('pdfs/' + pdfFile, '_blank');
    }

    function resetTool(){
      document.getElementById('result').style.display='none';
      document.getElementById('intro').style.display='block';
      document.getElementById('intro').classList.add('visible');
      const toolTitle = document.getElementById('tool-title');
      toolTitle.style.display = toolTitle.dataset.prevDisplay || '';
      document.getElementById('tool-title').classList.remove('assessing');
      bloodWell = medComplex = accessDiff = undefined;
      setProgress(0);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showElement(id){
      const el = document.getElementById(id);
      el.style.display='block';
      setTimeout(() => el.classList.add('visible'), 10);
    }
  </script>
</body>
</html>
